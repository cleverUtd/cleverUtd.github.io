

<!DOCTYPE html>
<html lang="zh-CN">
<head prefix="og: http://ogp.me/ns#">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
    <meta name="description" content="Keep Calm And Coding">
    <title>Shiro与Spring集成实现权限管理 | 刘梓</title>

    <!-- Open Graph -->
    <meta name="description" content="shiro核心概念Subject大多数情况下,可以简单理解成&amp;quot;当前用户&amp;quot;的概念,在代码任何地方都可以获取,获取后能够进行登录,登出,授权检查等操作
SecurityManagerSubject代表了当前用户的安全操作,SecurityManager管理所有用户的安全操作。它是Shiro框架的核心
Realms相当于数据源。配置Shiro时，必须至少指定一个Realm。执行认证和">
<meta property="og:type" content="article">
<meta property="og:title" content="Shiro与Spring集成实现权限管理">
<meta property="og:url" content="http://zclau.com/2016/02/16/Shiro与Spring集成实现权限管理/index.html">
<meta property="og:site_name" content="刘梓">
<meta property="og:description" content="shiro核心概念Subject大多数情况下,可以简单理解成&amp;quot;当前用户&amp;quot;的概念,在代码任何地方都可以获取,获取后能够进行登录,登出,授权检查等操作
SecurityManagerSubject代表了当前用户的安全操作,SecurityManager管理所有用户的安全操作。它是Shiro框架的核心
Realms相当于数据源。配置Shiro时，必须至少指定一个Realm。执行认证和">
<meta property="og:updated_time" content="2016-11-13T12:40:06.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Shiro与Spring集成实现权限管理">
<meta name="twitter:description" content="shiro核心概念Subject大多数情况下,可以简单理解成&amp;quot;当前用户&amp;quot;的概念,在代码任何地方都可以获取,获取后能够进行登录,登出,授权检查等操作
SecurityManagerSubject代表了当前用户的安全操作,SecurityManager管理所有用户的安全操作。它是Shiro框架的核心
Realms相当于数据源。配置Shiro时，必须至少指定一个Realm。执行认证和">

    <script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Person",
  "email": "mailto:cleverutd@gmail.com",
  "image": "undefined",
  "name": "zclau",
  "url": "http://zclau.com"
}
</script>
    <script>
    var algoliaEnabled = false;
    
</script>

    

    
    
        <link href="https://fonts.gmirror.org/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
    
    
    
        <!-- stylesheets list from config.yml -->
        
        <link rel="stylesheet" href="/css/aloha.css">
        
        <link rel="stylesheet" href="//cdn.bootcss.com/semantic-ui/2.2.4/semantic.min.css">
        
        <link rel="stylesheet" href="//cdn.bootcss.com/magnific-popup.js/1.1.0/magnific-popup.min.css">
        
    

</head>
<body id="body" style="margin-bottom: 0;" class="pushable">

    <div class="ui top fixed menu">
        <a class="item" id="menu-icon"><i class="sidebar icon"></i></a>
    </div>

    <div id="menu-sidebar" class="ui left vertical sidebar menu">

    <div id="sidebar-top">
        <div class="content">
            <h3>刘梓</h3>
        </div>
    </div>
    <div class="ui container sidebar-card">
    <div class="ui people shape content">
        <div class="active side">
            <div class="ui card">
                <div class="image">
                    <img class="ui medium bordered image" src="/images/avatar.jpg">
                </div>
                <div class="content">
                    <a class="header">zclau</a>
                    
                </div>
                <div class="extra content">
                    <div class="ui list">
                        
                        
                        <div class="item">
                            <i class="mail icon" style="float: left"></i>
                            <div class="content">
                                <a href="mailto:cleverutd@gmail.com">cleverutd@gmail.com</a>
                            </div>
                        </div>
                        
                    </div>

                </div>
                <div class="extra content">
                    <div class="ui list">
                        
                    </div>
                </div>
            </div>
        </div>
    </div>


</div>

    
    

    

    
    <a href="/index.html" class="item" >
        <i class="home icon"></i>
        首页
    </a>

    
    

    

    
    <a href="/atom.xml" class="item" >
        <i class="rss icon"></i>
        RSS
    </a>

    
    

    

    
    <a href="/archives/index.html" class="item" >
        <i class="archive icon"></i>
        归档
    </a>

    
    

    

    
    <a href="/booklist/index.html" class="item" >
        <i class="book icon"></i>
        书单
    </a>

    

    
</div>

    <div class="pusher body-content">
        <div id="content" class="ui main container">
            <!--<div class="ui one column grid">-->
                <!--<div class="column">-->
                    <!--<div class="ui main container">-->
                        <div id="post-Shiro与Spring集成实现权限管理" class="ui main container article-type-post">

    

    <div class="ui divided grid">

        <div class="two column row" id="article-content">

            <div class="thirteen wide computer thirteen wide tablet sixteen wide mobile column">
                

<h1 class="ui header">
    
    Shiro与Spring集成实现权限管理
</h1>



                <div class="article-inner">

                    <div class="article-entry" itemprop="articleBody">
                        
                        <h1 id="shiro&#x6838;&#x5FC3;&#x6982;&#x5FF5;"><a href="#shiro&#x6838;&#x5FC3;&#x6982;&#x5FF5;" class="headerlink" title="shiro&#x6838;&#x5FC3;&#x6982;&#x5FF5;"></a>shiro&#x6838;&#x5FC3;&#x6982;&#x5FF5;</h1><h2 id="Subject"><a href="#Subject" class="headerlink" title="Subject"></a>Subject</h2><pre><code>&#x5927;&#x591A;&#x6570;&#x60C5;&#x51B5;&#x4E0B;,&#x53EF;&#x4EE5;&#x7B80;&#x5355;&#x7406;&#x89E3;&#x6210;&quot;&#x5F53;&#x524D;&#x7528;&#x6237;&quot;&#x7684;&#x6982;&#x5FF5;,&#x5728;&#x4EE3;&#x7801;&#x4EFB;&#x4F55;&#x5730;&#x65B9;&#x90FD;&#x53EF;&#x4EE5;&#x83B7;&#x53D6;,&#x83B7;&#x53D6;&#x540E;&#x80FD;&#x591F;&#x8FDB;&#x884C;&#x767B;&#x5F55;,&#x767B;&#x51FA;,&#x6388;&#x6743;&#x68C0;&#x67E5;&#x7B49;&#x64CD;&#x4F5C;
</code></pre><h2 id="SecurityManager"><a href="#SecurityManager" class="headerlink" title="SecurityManager"></a>SecurityManager</h2><pre><code>Subject&#x4EE3;&#x8868;&#x4E86;&#x5F53;&#x524D;&#x7528;&#x6237;&#x7684;&#x5B89;&#x5168;&#x64CD;&#x4F5C;,SecurityManager&#x7BA1;&#x7406;&#x6240;&#x6709;&#x7528;&#x6237;&#x7684;&#x5B89;&#x5168;&#x64CD;&#x4F5C;&#x3002;&#x5B83;&#x662F;Shiro&#x6846;&#x67B6;&#x7684;&#x6838;&#x5FC3;
</code></pre><h2 id="Realms"><a href="#Realms" class="headerlink" title="Realms"></a>Realms</h2><pre><code>&#x76F8;&#x5F53;&#x4E8E;&#x6570;&#x636E;&#x6E90;&#x3002;&#x914D;&#x7F6E;Shiro&#x65F6;&#xFF0C;&#x5FC5;&#x987B;&#x81F3;&#x5C11;&#x6307;&#x5B9A;&#x4E00;&#x4E2A;Realm&#x3002;&#x6267;&#x884C;&#x8BA4;&#x8BC1;&#x548C;&#x6388;&#x6743;&#x65F6;&#xFF0C;shiro&#x4F1A;&#x4ECE;realms&#x83B7;&#x53D6;&#x8BA4;&#x8BC1;&#x6570;&#x636E;
</code></pre><a id="more"></a>
<p>&#x5173;&#x4E8E;shiro&#x7684;&#x6559;&#x7A0B;&#x8FD9;&#x91CC;&#x5C31;&#x4E0D;&#x8BE6;&#x8FF0;&#x4E86;&#xFF0C;&#x53EF;&#x53C2;&#x8003;&#xFF1A;</p>
<p><a href="https://waylau.gitbooks.io/apache-shiro-1-2-x-reference/content/index.html" target="_blank" rel="external">apache-shiro-1.2.x-reference</a></p>
<p><a href="http://jinnianshilongnian.iteye.com/blog/2049092" target="_blank" rel="external">&#x8DDF;&#x6211;&#x5B66;Shiro</a></p>
<p><a href="http://www.infoq.com/cn/articles/apache-shiro" target="_blank" rel="external">&#x8BA9;Apache Shiro&#x4FDD;&#x62A4;&#x4F60;&#x7684;&#x5E94;&#x7528;</a></p>
<h1 id="maven&#x914D;&#x7F6E;&#x4F9D;&#x8D56;"><a href="#maven&#x914D;&#x7F6E;&#x4F9D;&#x8D56;" class="headerlink" title="maven&#x914D;&#x7F6E;&#x4F9D;&#x8D56;"></a>maven&#x914D;&#x7F6E;&#x4F9D;&#x8D56;</h1><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">&lt;dependency&gt;</div><div class="line">        &lt;groupId&gt;org.apache.shiro&lt;/groupId&gt;</div><div class="line">        &lt;artifactId&gt;shiro-core&lt;/artifactId&gt;</div><div class="line">        &lt;version&gt;${shiro.version}&lt;/version&gt;</div><div class="line">&lt;/dependency&gt;</div><div class="line">&lt;dependency&gt;</div><div class="line">        &lt;groupId&gt;org.apache.shiro&lt;/groupId&gt;</div><div class="line">        &lt;artifactId&gt;shiro-web&lt;/artifactId&gt;</div><div class="line">        &lt;version&gt;${shiro.version}&lt;/version&gt;</div><div class="line">&lt;/dependency&gt;</div><div class="line">&lt;!-- &#x5982;&#x679C;&#x8981;&#x4E0E;spring&#x96C6;&#x6210;&#xFF0C;&#x9700;&#x8981;&#x6DFB;&#x52A0;&#x6B64;&#x4F9D;&#x8D56; --&gt;</div><div class="line">&lt;dependency&gt;</div><div class="line">        &lt;groupId&gt;org.apache.shiro&lt;/groupId&gt;</div><div class="line">        &lt;artifactId&gt;shiro-spring&lt;/artifactId&gt;</div><div class="line">        &lt;version&gt;${shiro.version}&lt;/version&gt;</div><div class="line">&lt;/dependency&gt;</div></pre></td></tr></table></figure>
<p>${shiro.version}&#x8BF7;&#x81EA;&#x884C;&#x66FF;&#x6362;&#x6210;&#x5F53;&#x524D;&#x7684;&#x6700;&#x65B0;&#x7248;&#x672C;</p>
<h1 id="&#x6574;&#x5408;spring"><a href="#&#x6574;&#x5408;spring" class="headerlink" title="&#x6574;&#x5408;spring"></a>&#x6574;&#x5408;spring</h1><h2 id="web-xml"><a href="#web-xml" class="headerlink" title="web.xml"></a>web.xml</h2><p>&#x589E;&#x52A0;filter&#x548C;filter-mapping</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"> &lt;<span class="built_in">filter</span>&gt;</div><div class="line">    &lt;<span class="built_in">filter</span>-name&gt;shiroFilter&lt;/<span class="built_in">filter</span>-name&gt;</div><div class="line">    &lt;<span class="built_in">filter</span>-class&gt;org.springframework.web.<span class="built_in">filter</span>.DelegatingFilterProxy&lt;/<span class="built_in">filter</span>-class&gt;</div><div class="line">    &lt;init-<span class="built_in">param</span>&gt;</div><div class="line">        &lt;<span class="built_in">param</span>-name&gt;targetFilterLifecycle&lt;/<span class="built_in">param</span>-name&gt;</div><div class="line">        &lt;<span class="built_in">param</span>-<span class="built_in">value</span>&gt;<span class="literal">true</span>&lt;/<span class="built_in">param</span>-<span class="built_in">value</span>&gt;</div><div class="line">    &lt;/init-<span class="built_in">param</span>&gt;</div><div class="line">&lt;/<span class="built_in">filter</span>&gt;</div><div class="line"></div><div class="line">&lt;<span class="built_in">filter</span>-mapping&gt;</div><div class="line">    &lt;<span class="built_in">filter</span>-name&gt;shiroFilter&lt;/<span class="built_in">filter</span>-name&gt;</div><div class="line">    &lt;url-pattern&gt;<span class="comment">/*&lt;/url-pattern&gt;</span></div><div class="line">&lt;/filter-mapping&gt;</div></pre></td></tr></table></figure>
<p>filter-name&#x5BF9;&#x5E94;spring&#x914D;&#x7F6E;&#x4E2D;&#x5B9A;&#x4E49;&#x7684;&#x540D;&#x5B57;&#x4E3A;&#x201C;shiroFilter&#x201D;&#x7684;bean</p>
<h2 id="spring&#x914D;&#x7F6E;"><a href="#spring&#x914D;&#x7F6E;" class="headerlink" title="spring&#x914D;&#x7F6E;"></a>spring&#x914D;&#x7F6E;</h2><p>&#x65B0;&#x5EFA;spring-shiro.xml<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span><span class="meta">?&gt;</span></span></div><div class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></div><div class="line">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="attr">xmlns:util</span>=<span class="string">&quot;http://www.springframework.org/schema/util&quot;</span></div><div class="line">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd&quot;</span>&gt;</div><div class="line"></div><div class="line">       <span class="comment">&lt;!-- &#x5B9A;&#x4E49;Realm --&gt;</span></div><div class="line">       <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;myRealm&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.uniweibov2.shiro.realm.MyRealm&quot;</span> /&gt;</span></div><div class="line">       <span class="comment">&lt;!-- &#x81EA;&#x5B9A;&#x4E49;filter --&gt;</span></div><div class="line">       <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;roles&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.uniweibov2.shiro.filter.MyRoleFilter&quot;</span> /&gt;</span></div><div class="line">       <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;perms&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.uniweibov2.shiro.filter.MyURLPermissionFilter&quot;</span> /&gt;</span></div><div class="line"></div><div class="line">       <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;securityManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.apache.shiro.web.mgt.DefaultWebSecurityManager&quot;</span>&gt;</span></div><div class="line">              <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;realm&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;myRealm&quot;</span>/&gt;</span></div><div class="line">       <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">  </div><div class="line">       <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;shiroFilter&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.apache.shiro.spring.web.ShiroFilterFactoryBean&quot;</span>&gt;</span></div><div class="line">              <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;securityManager&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;securityManager&quot;</span>/&gt;</span></div><div class="line">              <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;loginUrl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/user/login&quot;</span> /&gt;</span></div><div class="line">              <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;unauthorizedUrl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/unauth&quot;</span>  /&gt;</span></div><div class="line">              <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;filters&quot;</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">map</span>&gt;</span></div><div class="line">                            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;roles&quot;</span> <span class="attr">value-ref</span>=<span class="string">&quot;roles&quot;</span> /&gt;</span></div><div class="line">                            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;perms&quot;</span> <span class="attr">value-ref</span>=<span class="string">&quot;perms&quot;</span> /&gt;</span></div><div class="line">                     <span class="tag">&lt;/<span class="name">map</span>&gt;</span></div><div class="line">              <span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">              <span class="comment">&lt;!-- &#x8FC7;&#x6EE4;&#x94FE;&#x5B9A;&#x4E49; --&gt;</span>  </div><div class="line">              <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;filterChainDefinitions&quot;</span>&gt;</span></div><div class="line">                     <span class="tag">&lt;<span class="name">value</span>&gt;</span></div><div class="line">                            /user/login = anon <span class="comment">&lt;!--anon:anonymous, &#x533F;&#x540D;&#x7684;, &#x4E0D;&#x9700;&#x8981;&#x6743;&#x9650; --&gt;</span></div><div class="line">                            /user/logout = logout</div><div class="line">                            /my/customer/** = roles[&quot;user&quot;]   <span class="comment">&lt;!-- &#x9700;&#x8981;&#x540D;&#x79F0;&#x4E3A;user&#x7684;&#x89D2;&#x8272;&#x6743;&#x9650;--&gt;</span></div><div class="line">                           /customer/**=perms </div><div class="line">                     <span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">              <span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">       <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"></div><div class="line">       <span class="comment">&lt;!-- Shiro&#x751F;&#x547D;&#x5468;&#x671F;&#x5904;&#x7406;&#x5668; --&gt;</span></div><div class="line">       <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;lifecycleBeanPostProcessor&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.apache.shiro.spring.LifecycleBeanPostProcessor&quot;</span>/&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>filters&#x5C5E;&#x6027;&#x7528;&#x4E8E;&#x81EA;&#x5B9A;&#x4E49;&#x8FC7;&#x6EE4;&#x5668;</p>
<p>filterChainDefinitions&#x7528;&#x4E8E;&#x58F0;&#x660E;url&#x548C;filter&#x7684;&#x5173;&#x7CFB;&#xFF0C;&#x5373;&#x54EA;&#x4E9B;URL&#x9700;&#x8981;&#x7ECF;&#x8FC7;&#x54EA;&#x4E9B;filter&#x8FDB;&#x884C;&#x9274;&#x6743;</p>
<p>shiro&#x4E5F;&#x6709;&#x5F88;&#x591A;&#x9ED8;&#x8BA4;&#x7684;filter&#xFF0C;&#x4E0A;&#x9762;&#x7684;anon&#x548C;logout&#x4F7F;&#x7528;&#x7684;&#x5C31;&#x662F;shiro&#x9ED8;&#x8BA4;filter&#x3002;&#x9ED8;&#x8BA4;&#x7684;roles&#x548C;perms filter&#x4E0D;&#x6EE1;&#x8DB3;&#x8981;&#x6C42;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x4F7F;&#x7528;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x5B9E;&#x73B0;</p>
<p>&#x914D;&#x7F6E;&#x597D;spring-shiro.xml&#xFF0C;&#x5728;spring.xml&#x91CC;import&#x5373;&#x53EF;&#x3002;</p>
<h1 id="&#x81EA;&#x5B9A;&#x4E49;Realm"><a href="#&#x81EA;&#x5B9A;&#x4E49;Realm" class="headerlink" title="&#x81EA;&#x5B9A;&#x4E49;Realm"></a>&#x81EA;&#x5B9A;&#x4E49;Realm</h1><p>&#x65B0;&#x5EFA;MyRealm&#xFF1A;<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div></pre></td><td class="code"><pre><div class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MyRealm</span> <span class="keyword">extends</span> <span class="title">AuthorizingRealm</span> </span>{</div><div class="line"></div><div class="line">    <span class="meta">@Autowired</span></div><div class="line">    <span class="keyword">private</span> <span class="type">UserRoleService</span> userRoleService;</div><div class="line">    <span class="meta">@Autowired</span></div><div class="line">    <span class="keyword">private</span> <span class="type">RoleResourcesService</span> roleResourcesService;</div><div class="line">    <span class="meta">@Autowired</span></div><div class="line">    <span class="keyword">private</span> <span class="type">ShiroRedis</span> shiroRedis;</div><div class="line"></div><div class="line">    <span class="type">Logger</span> log = <span class="type">LoggerFactory</span>.getLogger(<span class="type">MyRealm</span>.<span class="keyword">class</span>);</div><div class="line"></div><div class="line">     <span class="comment">/**</span></div><div class="line">     * &#x83B7;&#x53D6;&#x6388;&#x6743;&#x4FE1;&#x606F;</div><div class="line">     * &#x6BCF;&#x5F53;&#x9700;&#x8981;&#x9274;&#x6743;&#x65F6;&#xFF0C;&#x90FD;&#x4F1A;&#x5148;&#x901A;&#x8FC7;&#x6B64;&#x65B9;&#x6CD5;&#x83B7;&#x53D6;&#x7528;&#x6237;&#x62E5;&#x6709;&#x7684;&#x6743;&#x9650;&#xFF0C;&#x5E76;&#x5305;&#x88C5;&#x6210;shiro&#x81EA;&#x5DF1;&#x5C01;&#x88C5;&#x7684;AuthorizationInfo&#x5BF9;&#x8C61;&#x91CC;&#x9762;</div><div class="line">     */</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">protected</span> <span class="type">AuthorizationInfo</span> getAuthorizationInfo(<span class="type">PrincipalCollection</span> principals) {</div><div class="line">        <span class="keyword">if</span> (principals == <span class="literal">null</span>) {</div><div class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</div><div class="line">        } <span class="keyword">else</span> {</div><div class="line">            <span class="type">AuthorizationInfo</span> info = <span class="literal">null</span>;</div><div class="line">            <span class="keyword">if</span> (log.isTraceEnabled()) {</div><div class="line">                log.trace(<span class="string">&quot;Retrieving AuthorizationInfo for principals [&quot;</span> + principals + <span class="string">&quot;]&quot;</span>);</div><div class="line">            }</div><div class="line"></div><div class="line">            info = shiroRedis.getAuthinfo(principals.toString());</div><div class="line">            <span class="keyword">if</span> (info == <span class="literal">null</span>) {</div><div class="line">                info = <span class="keyword">this</span>.doGetAuthorizationInfo(principals);</div><div class="line">                <span class="keyword">if</span> (info != <span class="literal">null</span>) {</div><div class="line">                    <span class="keyword">if</span> (log.isTraceEnabled()) {</div><div class="line">                        log.trace(<span class="string">&quot;Caching authorization info for principals: [&quot;</span> + principals + <span class="string">&quot;].&quot;</span>);</div><div class="line">                    }</div><div class="line">                    shiroRedis.putAuthinfo(principals.toString(), <span class="type">JsonUtil</span>.obj2JsonStr(info));</div><div class="line">                }</div><div class="line">            }</div><div class="line">            <span class="keyword">return</span> info;</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * &#x83B7;&#x53D6;&#x6388;&#x6743;&#x4FE1;&#x606F;&#xFF0C;&#x5728;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x4ECE;db&#x83B7;&#x53D6;&#x5F53;&#x524D;&#x767B;&#x5F55;&#x7528;&#x6237;&#x7684;&#x89D2;&#x8272;&#x548C;&#x8D44;&#x6E90;&#x6743;&#x9650;&#x4FE1;&#x606F;</div><div class="line">     */</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">protected</span> <span class="type">AuthorizationInfo</span> doGetAuthorizationInfo(<span class="type">PrincipalCollection</span> principalCollection) {</div><div class="line">        int userId = <span class="type">Integer</span>.parseInt((<span class="type">String</span>) getAvailablePrincipal(principalCollection));</div><div class="line">        <span class="type">List</span>&lt;<span class="type">UserRoles</span>&gt; userRoles = userRoleService.getRoleByUserId(userId);</div><div class="line"></div><div class="line">        <span class="comment">//&#x901A;&#x8FC7;&#x7528;&#x6237;&#x540D;&#x4ECE;&#x6570;&#x636E;&#x5E93;&#x83B7;&#x53D6;&#x6743;&#x9650;&#x5B57;&#x7B26;&#x4E32;</span></div><div class="line">        <span class="type">SimpleAuthorizationInfo</span> info = <span class="keyword">new</span> <span class="type">SimpleAuthorizationInfo</span>();</div><div class="line">        <span class="comment">//&#x89D2;&#x8272;&#x6743;&#x9650;</span></div><div class="line">        <span class="type">Set</span>&lt;<span class="type">String</span>&gt; roleSet = <span class="keyword">new</span> <span class="type">HashSet</span>&lt;&gt;();</div><div class="line">        <span class="comment">//&#x8D44;&#x6E90;&#x6743;&#x9650;</span></div><div class="line">        <span class="type">Set</span>&lt;<span class="type">String</span>&gt; resourcesSet = <span class="keyword">new</span> <span class="type">HashSet</span>&lt;&gt;();</div><div class="line"></div><div class="line">        <span class="keyword">for</span> (<span class="type">UserRoles</span> userRole : userRoles) {</div><div class="line">            roleSet.add(userRole.getRoleName());</div><div class="line">            <span class="type">List</span>&lt;<span class="type">RoleResources</span>&gt; resourceList = roleResourcesService.getResourcesByRole(userRole.getRoleId());</div><div class="line">            <span class="keyword">for</span>(<span class="type">RoleResources</span> roleResources : resourceList) {</div><div class="line">                resourcesSet.add(roleResources.getUri() + <span class="string">&quot;:&quot;</span> + roleResources.getMethod());</div><div class="line">            }</div><div class="line">        }</div><div class="line">        info.setRoles(roleSet);</div><div class="line">        info.setStringPermissions(resourcesSet);</div><div class="line">        <span class="keyword">return</span> info;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * &#x8EAB;&#x4EFD;&#x8BA4;&#x8BC1;</div><div class="line">     */</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">protected</span> <span class="type">AuthenticationInfo</span> doGetAuthenticationInfo(<span class="type">AuthenticationToken</span> token) <span class="keyword">throws</span> <span class="type">AuthenticationException</span> {</div><div class="line">        <span class="type">String</span> userId = (<span class="type">String</span>) token.getPrincipal();</div><div class="line">        <span class="type">String</span> password = <span class="keyword">new</span> <span class="type">String</span>((char[]) token.getCredentials());</div><div class="line">        <span class="type">AuthenticationInfo</span> aInfo = <span class="keyword">new</span> <span class="type">SimpleAuthenticationInfo</span>(userId, password, getName());</div><div class="line">        <span class="keyword">return</span> aInfo;</div><div class="line">    }</div></pre></td></tr></table></figure></p>
<p>AuthorizingRealm&#x662F;Shiro&#x8D1F;&#x8D23;&#x8EAB;&#x4EFD;&#x8BA4;&#x8BC1;&#x7684;&#x62BD;&#x8C61;&#x7C7B;&#x3002;&#x9700;&#x8981;&#x5B9E;&#x73B0;doGetAuthenticationInfo&#x548C;doGetAuthorizationInfo&#x65B9;&#x6CD5;&#x3002;</p>
<p>&#x4E00;&#x822C;&#x6765;&#x8BF4;&#x5728;doGetAuthenticationInfo&#x65B9;&#x6CD5;&#x91CC;,&#x5B9E;&#x73B0;&#x7684;&#x662F;&#x5BF9;&#x7528;&#x6237;&#x63D0;&#x4EA4;&#x8FC7;&#x6765;&#x7684;&#x7528;&#x6237;&#x540D;/&#x5BC6;&#x7801; &#x7B49;&#x8D26;&#x53F7;&#x4FE1;&#x606F;,&#x8DDF;&#x6570;&#x636E;&#x5E93;&#x8FDB;&#x884C;&#x4EA4;&#x4E92;&#x5224;&#x5B9A;&#x767B;&#x9646;&#x662F;&#x5426;&#x6210;&#x529F;&#x7684;&#x8FC7;&#x7A0B;&#x3002;&#x4F46;&#x662F;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x7684;&#x7CFB;&#x7EDF;&#x4E4B;&#x524D;&#x5DF2;&#x7ECF;&#x6709;&#x81EA;&#x5DF1;&#x7684;&#x4E00;&#x5957;&#x8BA4;&#x8BC1;&#x903B;&#x8F91;&#xFF0C;&#x6240;&#x4EE5;&#x5728;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x91CC;&#x5C31;&#x4E0D;&#x8FDB;&#x884C;&#x5339;&#x914D;&#xFF0C;&#x53EA;&#x662F;&#x7B80;&#x5355;&#x7684;&#x5305;&#x88C5;&#x6210;AuthenticationInfo&#x5BF9;&#x8C61;&#x5E76;&#x8FD4;&#x56DE;&#x3002;<br>&#x800C;&#x5728;&#x539F;&#x6765;&#x7684;&#x767B;&#x5F55;&#x8BA4;&#x8BC1;&#x4EE3;&#x7801;&#x4E2D;(UserController&#x7684;login&#x65B9;&#x6CD5;)&#xFF0C;&#x5728;&#x5339;&#x914D;&#x6210;&#x529F;&#x540E;&#xFF0C;&#x6DFB;&#x52A0;&#x4EE5;&#x4E0B;&#x4EE3;&#x7801;<br><figure class="highlight pony"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="type">Subject</span> subject = <span class="type">SecurityUtils</span>.getSubject();</div><div class="line"><span class="type">UsernamePasswordToken</span> token = <span class="function"><span class="keyword">new</span> <span class="title">UsernamePasswordToken</span>(user.getUserId().<span class="title">toString</span>(), <span class="title">user</span>.<span class="title">getPasswd</span>());</span></div><div class="line"><span class="comment">//&#x6B64;&#x65B9;&#x6CD5;&#x4F1A;&#x8FDB;&#x5165;MyRealm&#x7684;doGetAuthenticationInfo()&#x65B9;&#x6CD5;</span></div><div class="line"><span class="title">subject</span>.<span class="title">login</span>(token);</div></pre></td></tr></table></figure></p>
<p>getAuthorizationInfo&#x91CD;&#x5199;&#x7236;&#x7C7B;&#x65B9;&#x6CD5;&#xFF0C;&#x6B64;&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x5148;&#x901A;&#x8FC7;redis&#x67E5;&#x627E;&#x7528;&#x6237;&#x7684;&#x8BA4;&#x8BC1;&#x4FE1;&#x606F;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x8C03;&#x7528;doGetAuthorizationInfo&#x65B9;&#x6CD5;&#x4ECE;db&#x4E2D;&#x83B7;&#x53D6;&#x3002;<br>&#x56E0;&#x4E3A;shiro&#x9ED8;&#x8BA4;&#x7684;&#x7F13;&#x5B58;&#x53EA;&#x63D0;&#x4F9B;ecache&#x5B9E;&#x73B0;&#xFF0C;&#x6240;&#x4EE5;&#x9700;&#x8981;&#x91CD;&#x5199;getAuthorizationInfo&#xFF0C;&#x81EA;&#x5B9A;&#x4E49;redis&#x7684;&#x7F13;&#x5B58;&#x5B9E;&#x73B0;</p>
<p>doGetAuthorizationInfo &#x7684;&#x4E2D;&#x8D44;&#x6E90;&#x6743;&#x9650;&#x6211;&#x4F7F;&#x7528;URI:method(&#x201C;/user/create:post&#x201D;) &#x5F62;&#x5F0F;&#x4F5C;&#x4E3A;&#x6743;&#x9650;&#x5B57;&#x7B26;&#x4E32;</p>
<h1 id="&#x6743;&#x9650;&#x6821;&#x9A8C;"><a href="#&#x6743;&#x9650;&#x6821;&#x9A8C;" class="headerlink" title="&#x6743;&#x9650;&#x6821;&#x9A8C;"></a>&#x6743;&#x9650;&#x6821;&#x9A8C;</h1><h2 id="&#x6570;&#x636E;&#x5E93;&#x8BBE;&#x8BA1;"><a href="#&#x6570;&#x636E;&#x5E93;&#x8BBE;&#x8BA1;" class="headerlink" title="&#x6570;&#x636E;&#x5E93;&#x8BBE;&#x8BA1;"></a>&#x6570;&#x636E;&#x5E93;&#x8BBE;&#x8BA1;</h2><p>&#x89D2;&#x8272;&#x8868;<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`roles`</span> (</div><div class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT <span class="keyword">COMMENT</span> <span class="string">&apos;&#x89D2;&#x8272;id&apos;</span>,</div><div class="line">  <span class="string">`name`</span> <span class="built_in">varchar</span>(<span class="number">32</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&apos;&apos;</span> <span class="keyword">COMMENT</span> <span class="string">&apos;&#x89D2;&#x8272;&#x540D;&#x79F0;&apos;</span>,</div><div class="line">  <span class="string">`detail`</span> <span class="built_in">varchar</span>(<span class="number">32</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&apos;&apos;</span> <span class="keyword">COMMENT</span> <span class="string">&apos;&#x89D2;&#x8272;&#x9644;&#x52A0;&#x63CF;&#x8FF0;&apos;</span>,</div><div class="line">  <span class="string">`create_time`</span> <span class="keyword">timestamp</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&apos;0000-00-00 00:00:00&apos;</span> <span class="keyword">COMMENT</span> <span class="string">&apos;&#x521B;&#x5EFA;&#x65F6;&#x95F4;&apos;</span>,</div><div class="line">  <span class="string">`update_time`</span> <span class="keyword">timestamp</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="keyword">CURRENT_TIMESTAMP</span> <span class="keyword">COMMENT</span> <span class="string">&apos;&#x66F4;&#x65B0;&#x65F6;&#x95F4;&apos;</span>,</div><div class="line">  <span class="string">`is_deleted`</span> tinyint(<span class="number">4</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&apos;0&apos;</span> <span class="keyword">COMMENT</span> <span class="string">&apos;&#x5220;&#x9664;&#x6807;&#x8BC6;,0.&#x53EF;&#x7528;&#xFF0C;1.&#x5DF2;&#x5220;&#x9664;&#x4E0D;&#x53EF;&#x7528;&apos;</span>,</div><div class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>),</div><div class="line">  <span class="keyword">UNIQUE</span> <span class="keyword">KEY</span> <span class="string">`u_key_name`</span> (<span class="string">`name`</span>)</div><div class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8 <span class="keyword">COMMENT</span>=<span class="string">&apos;&#x89D2;&#x8272;&#x8868;&apos;</span>;</div></pre></td></tr></table></figure></p>
<p>&#x7528;&#x6237;&#x89D2;&#x8272;&#x6620;&#x5C04;<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`user_roles`</span> (</div><div class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT <span class="keyword">COMMENT</span> <span class="string">&apos;&#x81EA;&#x589E;id&apos;</span>,</div><div class="line">  <span class="string">`user_id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&apos;0&apos;</span> <span class="keyword">COMMENT</span> <span class="string">&apos;&#x7528;&#x6237;uid, &#x5BF9;&#x5E94;&#x8868;users(u_id)&apos;</span>,</div><div class="line">  <span class="string">`role_id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&apos;0&apos;</span> <span class="keyword">COMMENT</span> <span class="string">&apos;&#x89D2;&#x8272;id, &#x5BF9;&#x5E94;&#x8868;roles(ro_id)&apos;</span>,</div><div class="line">  <span class="string">`create_time`</span> <span class="keyword">timestamp</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&apos;0000-00-00 00:00:00&apos;</span> <span class="keyword">COMMENT</span> <span class="string">&apos;&#x521B;&#x5EFA;&#x65F6;&#x95F4;&apos;</span>,</div><div class="line">  <span class="string">`update_time`</span> <span class="keyword">timestamp</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="keyword">CURRENT_TIMESTAMP</span> <span class="keyword">COMMENT</span> <span class="string">&apos;&#x66F4;&#x65B0;&#x65F6;&#x95F4;&apos;</span>,</div><div class="line">  <span class="string">`is_deleted`</span> tinyint(<span class="number">4</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&apos;0&apos;</span> <span class="keyword">COMMENT</span> <span class="string">&apos;&#x5220;&#x9664;&#x6807;&#x8BC6;,0.&#x53EF;&#x7528;&#xFF0C;1.&#x5DF2;&#x5220;&#x9664;&#x4E0D;&#x53EF;&#x7528;&apos;</span>,</div><div class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>),</div><div class="line">  <span class="keyword">UNIQUE</span> <span class="keyword">KEY</span> <span class="string">`u_key_u_id_ro_id`</span> (<span class="string">`user_id`</span>,<span class="string">`role_id`</span>),</div><div class="line">  <span class="keyword">KEY</span> <span class="string">`u_key_ro_id`</span> (<span class="string">`role_id`</span>) <span class="keyword">USING</span> BTREE</div><div class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8 <span class="keyword">COMMENT</span>=<span class="string">&apos;&#x7528;&#x6237;&#x89D2;&#x8272;&#x8868;&apos;</span>;</div></pre></td></tr></table></figure></p>
<p>&#x8D44;&#x6E90;&#x8868;(&#x8BB0;&#x5F55;&#x7CFB;&#x7EDF;&#x4F7F;&#x7528;&#x5230;&#x7684;URL)<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`resources`</span> (</div><div class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT <span class="keyword">COMMENT</span> <span class="string">&apos;&#x81EA;&#x589E;id&apos;</span>,</div><div class="line">  <span class="string">`uri`</span> <span class="built_in">varchar</span>(<span class="number">64</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&apos;&apos;</span> <span class="keyword">COMMENT</span> <span class="string">&apos;&#x8BF7;&#x6C42;&#x76F8;&#x5BF9;&#x8DEF;&#x5F84;&apos;</span>,</div><div class="line">  <span class="string">`method`</span> <span class="built_in">varchar</span>(<span class="number">8</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&apos;&apos;</span> <span class="keyword">COMMENT</span><span class="string">&apos;&#x8BF7;&#x6C42;&#x65B9;&#x6CD5; GET/POST&apos;</span>,</div><div class="line">  <span class="string">`detail`</span> <span class="built_in">varchar</span>(<span class="number">32</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&apos;&apos;</span> <span class="keyword">COMMENT</span> <span class="string">&apos;uri&#x8BE6;&#x7EC6;&#x63CF;&#x8FF0;&apos;</span>,</div><div class="line">  <span class="string">`create_time`</span> <span class="keyword">timestamp</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&apos;0000-00-00 00:00:00&apos;</span> <span class="keyword">COMMENT</span> <span class="string">&apos;&#x521B;&#x5EFA;&#x65F6;&#x95F4;&apos;</span>,</div><div class="line">  <span class="string">`update_time`</span> <span class="keyword">timestamp</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="keyword">CURRENT_TIMESTAMP</span> <span class="keyword">COMMENT</span> <span class="string">&apos;&#x66F4;&#x65B0;&#x65F6;&#x95F4;&apos;</span>,</div><div class="line">  <span class="string">`is_deleted`</span> tinyint(<span class="number">4</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&apos;0&apos;</span> <span class="keyword">COMMENT</span> <span class="string">&apos;&#x5220;&#x9664;&#x6807;&#x8BC6;,0.&#x53EF;&#x7528;&#xFF0C;1.&#x5DF2;&#x5220;&#x9664;&#x4E0D;&#x53EF;&#x7528;&apos;</span>,</div><div class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>),</div><div class="line">  <span class="keyword">UNIQUE</span> <span class="keyword">KEY</span> <span class="string">`u_key_uri_method`</span> (<span class="string">`uri`</span>,<span class="string">`method`</span>) <span class="keyword">USING</span> BTREE</div><div class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8 <span class="keyword">COMMENT</span>=<span class="string">&apos;&#x8BF7;&#x6C42;&#x76F8;&#x5BF9;&#x8DEF;&#x5F84;&#x8BB0;&#x5F55;&#x8868;&apos;</span>;</div></pre></td></tr></table></figure></p>
<p>&#x89D2;&#x8272;-&#x8D44;&#x6E90;&#x6743;&#x9650;&#x6620;&#x5C04;&#x8868;<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`role_resources`</span> (</div><div class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT <span class="keyword">COMMENT</span> <span class="string">&apos;&#x81EA;&#x589E;id&apos;</span>,</div><div class="line">  <span class="string">`resource_id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&apos;0&apos;</span> <span class="keyword">COMMENT</span> <span class="string">&apos;&#x8BF7;&#x6C42;&#x76F8;&#x5BF9;&#x8DEF;&#x5F84;id&apos;</span>,</div><div class="line">  <span class="string">`role_id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&apos;0&apos;</span> <span class="keyword">COMMENT</span> <span class="string">&apos;&#x89D2;&#x8272;id&apos;</span>,</div><div class="line">  <span class="string">`create_time`</span> <span class="keyword">timestamp</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&apos;0000-00-00 00:00:00&apos;</span> <span class="keyword">COMMENT</span> <span class="string">&apos;&#x521B;&#x5EFA;&#x65F6;&#x95F4;&apos;</span>,</div><div class="line">  <span class="string">`update_time`</span> <span class="keyword">timestamp</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="keyword">CURRENT_TIMESTAMP</span> <span class="keyword">COMMENT</span> <span class="string">&apos;&#x66F4;&#x65B0;&#x65F6;&#x95F4;&apos;</span>,</div><div class="line">  <span class="string">`is_deleted`</span> tinyint(<span class="number">4</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&apos;0&apos;</span> <span class="keyword">COMMENT</span> <span class="string">&apos;&#x5220;&#x9664;&#x6807;&#x8BC6;,0.&#x53EF;&#x7528;&#xFF0C;1.&#x5DF2;&#x5220;&#x9664;&#x4E0D;&#x53EF;&#x7528;&apos;</span>,</div><div class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>),</div><div class="line">  <span class="keyword">UNIQUE</span> <span class="keyword">KEY</span> <span class="string">`u_key_role_resource`</span> (<span class="string">`role_id`</span>,<span class="string">`resource_id`</span>)</div><div class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8 <span class="keyword">COMMENT</span>=<span class="string">&apos;&#x89D2;&#x8272;-&#x8D44;&#x6E90;&#x6743;&#x9650;&#x6620;&#x5C04;&#x8868;&apos;</span>;</div></pre></td></tr></table></figure></p>
<p>user&#x548C;role&#x662F;&#x591A;&#x5BF9;&#x591A;&#x5173;&#x7CFB;&#xFF0C;&#x89D2;&#x8272;&#x548C;&#x8D44;&#x6E90;&#x4E5F;&#x662F;&#x591A;&#x5BF9;&#x591A;&#x5173;&#x7CFB;</p>
<h2 id="&#x89D2;&#x8272;&#x6821;&#x9A8C;"><a href="#&#x89D2;&#x8272;&#x6821;&#x9A8C;" class="headerlink" title="&#x89D2;&#x8272;&#x6821;&#x9A8C;"></a>&#x89D2;&#x8272;&#x6821;&#x9A8C;</h2><p>&#x81EA;&#x5B9A;&#x4E49;RolesAuthorizationFilter<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MyRoleFilter</span> <span class="keyword">extends</span> <span class="title">RolesAuthorizationFilter</span> </span>{</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="type">Logger</span> log = <span class="type">LoggerFactory</span>.getLogger(<span class="type">MyRoleFilter</span>.<span class="keyword">class</span>);</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">protected</span> boolean onAccessDenied(<span class="type">ServletRequest</span> request, <span class="type">ServletResponse</span> response) <span class="keyword">throws</span> <span class="type">IOException</span> {</div><div class="line">        <span class="type">HttpServletRequest</span> req = com.uniweibov2.shiro.<span class="type">WebUtils</span>.toHttp(request);</div><div class="line">        <span class="type">HttpServletResponse</span> res = com.uniweibov2.shiro.<span class="type">WebUtils</span>.toHttp(response);</div><div class="line">        <span class="type">String</span> path = <span class="type">WebUtils</span>.getRequestUri(req);</div><div class="line">      <span class="comment">//my&#x5F00;&#x5934;&#x7684;&#x8BF7;&#x6C42;&#x7528;&#x4E8E;&#x9875;&#x9762;&#x8DF3;&#x8F6C;</span></div><div class="line">        <span class="keyword">if</span> (path.startsWith(<span class="string">&quot;/my&quot;</span>)) {</div><div class="line">            res.sendError(<span class="number">401</span>);</div><div class="line">        } <span class="keyword">else</span> { <span class="comment">//&#x5176;&#x4F59;&#x662F;ajax&#x5F02;&#x6B65;&#x8BF7;&#x6C42;</span></div><div class="line">            <span class="type">PrintWriter</span> out = response.getWriter();</div><div class="line">            out.println(<span class="string">&quot;{\&quot;error_info\&quot;:\&quot;permission denied.\&quot;}&quot;</span>);</div><div class="line">            out.flush();</div><div class="line">            out.close();</div><div class="line">        }</div><div class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    public boolean isAccessAllowed(<span class="type">ServletRequest</span> request, <span class="type">ServletResponse</span> response, <span class="type">Object</span> mappedValue) <span class="keyword">throws</span> <span class="type">IOException</span> {</div><div class="line"></div><div class="line">        <span class="keyword">final</span> <span class="type">Subject</span> subject = getSubject(request, response);</div><div class="line">        <span class="type">HttpServletRequest</span> req = (<span class="type">HttpServletRequest</span>) request;</div><div class="line">        <span class="comment">//mappedValue&#x7684;&#x503C;&#x5C31;&#x662F;&#x4E0A;&#x9762;spring-shiro.xml &#x8FC7;&#x6EE4;&#x5668;&#x94FE;&#x5B9A;&#x4E49;&#x4E2D;roles[&quot;user,admin&quot;] &#x62EC;&#x53F7;&#x91CC;&#x9762;&#x7684;&#x503C;</span></div><div class="line">        <span class="keyword">final</span> <span class="type">String</span>[] rolesArray = (<span class="type">String</span>[]) mappedValue;</div><div class="line">        <span class="keyword">if</span> (rolesArray == <span class="literal">null</span> || rolesArray.length == <span class="number">0</span>) {</div><div class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keyword">for</span> (<span class="type">String</span> roleName : rolesArray) {</div><div class="line">            <span class="keyword">if</span> (subject.hasRole(roleName)) {  <span class="comment">//&#x5224;&#x65AD;&#x5F53;&#x524D;&#x7528;&#x6237;&#x662F;&#x5426;&#x62E5;&#x6709;&#x8FD9;&#x4E2A;&#x89D2;&#x8272;</span></div><div class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    }</div></pre></td></tr></table></figure></p>
<p>MyRoleFilter&#x91CD;&#x5199;isAccessAllowed&#x548C;onAccessDenied&#x65B9;&#x6CD5;</p>
<p>isAccessAllowed&#x65B9;&#x6CD5;&#x7528;&#x4E8E;&#x89D2;&#x8272;&#x6743;&#x9650;&#x68C0;&#x6D4B;&#xFF0C;&#x56E0;&#x4E3A;&#x7236;&#x7C7B;&#x7684;isAccessAllowed&#x65B9;&#x6CD5;&#x4E2D;&#x7684;&#x68C0;&#x6D4B;&#x903B;&#x8F91;&#x662F;&#x5FC5;&#x987B;&#x7B26;&#x5408;&#x6240;&#x6709;mappedValue&#x4E2D;&#x7684;&#x89D2;&#x8272;&#xFF0C;&#x800C;&#x6211;&#x4EEC;&#x7684;&#x9700;&#x6C42;&#x662F;&#x53EA;&#x6709;&#x7528;&#x6237;&#x5C5E;&#x4E8E;&#x5176;&#x4E2D;&#x4EFB;&#x610F;&#x4E00;&#x4E2A;&#x89D2;&#x8272;&#x5C31;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4E86;&#xFF0C;&#x56E0;&#x6B64;&#x9700;&#x8981;&#x81EA;&#x5B9A;&#x4E49;&#x5B9E;&#x73B0;</p>
<p>onAccessDenied&#x65B9;&#x6CD5;&#x5B9E;&#x73B0;&#x7684;&#x662F;&#x5F53;&#x6743;&#x9650;&#x4E0D;&#x901A;&#x8FC7;&#x65F6;&#xFF0C;&#x5E94;&#x8BE5;&#x5982;&#x4F55;&#x5904;&#x7406;</p>
<h2 id="URL&#x6743;&#x9650;&#x6821;&#x9A8C;"><a href="#URL&#x6743;&#x9650;&#x6821;&#x9A8C;" class="headerlink" title="URL&#x6743;&#x9650;&#x6821;&#x9A8C;"></a>URL&#x6743;&#x9650;&#x6821;&#x9A8C;</h2><p>&#x81EA;&#x5B9A;&#x4E49;PermissionsAuthorizationFilter<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MyURLPermissionFilter</span> <span class="keyword">extends</span> <span class="title">PermissionsAuthorizationFilter</span></span>{</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="type">Logger</span> log = <span class="type">LoggerFactory</span>.getLogger(<span class="type">MyURLPermissionFilter</span>.<span class="keyword">class</span>);</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">protected</span> boolean onAccessDenied(<span class="type">ServletRequest</span> request, <span class="type">ServletResponse</span> response) <span class="keyword">throws</span> <span class="type">IOException</span> {</div><div class="line">        <span class="type">HttpServletRequest</span> req = <span class="type">WebUtils</span>.toHttp(request);</div><div class="line">        <span class="type">HttpServletResponse</span> res = <span class="type">WebUtils</span>.toHttp(response);</div><div class="line">        <span class="type">String</span> path = <span class="type">WebUtils</span>.getRequestUri(req);</div><div class="line">        <span class="keyword">if</span>(path.startsWith(<span class="string">&quot;/my/&quot;</span>)) {</div><div class="line">            res.sendError(<span class="number">401</span>);</div><div class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        } <span class="keyword">else</span> {</div><div class="line">            <span class="type">PrintWriter</span> out = response.getWriter();</div><div class="line">            out.println(<span class="string">&quot;{\&quot;error_info\&quot;:\&quot;permission denied.\&quot;}&quot;</span>);</div><div class="line">            out.flush();</div><div class="line">            out.close();</div><div class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    public boolean isAccessAllowed(<span class="type">ServletRequest</span> request, <span class="type">ServletResponse</span> response, <span class="type">Object</span> mappedValue) <span class="keyword">throws</span> <span class="type">IOException</span> {</div><div class="line">        <span class="type">Subject</span> subject = <span class="keyword">this</span>.getSubject(request, response);</div><div class="line">        <span class="type">HttpServletRequest</span> req = <span class="type">WebUtils</span>.toHttp(request);</div><div class="line">        <span class="type">String</span> path = <span class="type">WebUtils</span>.getRequestUri(req);</div><div class="line">        <span class="type">String</span> method = req.getMethod();</div><div class="line">        <span class="type">String</span> permission = path + <span class="string">&quot;:&quot;</span> + method;</div><div class="line"></div><div class="line">        <span class="keyword">if</span>(!subject.isPermitted(permission)) { <span class="comment">//&#x4E0E;&#x4E0A;&#x6587;MyRealm&#x7684;getAuthorizationInfo&#x65B9;&#x6CD5;&#x8FD4;&#x56DE;&#x7684;AuthorizationInfo&#x4E2D;&#x7684;&#x6743;&#x9650;&#x96C6;&#x5408;&#x5339;&#x914D;</span></div><div class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        }</div><div class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">    }</div></pre></td></tr></table></figure></p>
<p>&#x5230;&#x76EE;&#x524D;&#x4E3A;&#x6B62;&#xFF0C;&#x5DF2;&#x7ECF;&#x5B8C;&#x6210;shiro&#x4E0E;spring&#x6574;&#x5408;&#xFF0C;&#x5E76;&#x4E14;&#x5B9E;&#x73B0;&#x4E86;&#x89D2;&#x8272;&#x548C;URL&#x7684;&#x6743;&#x9650;&#x7BA1;&#x7406;&#x4E86;&#x3002;</p>
<h1 id="&#x5E38;&#x89C1;&#x95EE;&#x9898;"><a href="#&#x5E38;&#x89C1;&#x95EE;&#x9898;" class="headerlink" title="&#x5E38;&#x89C1;&#x95EE;&#x9898;"></a>&#x5E38;&#x89C1;&#x95EE;&#x9898;</h1><h2 id="&#x5173;&#x4E8E;shiro-session"><a href="#&#x5173;&#x4E8E;shiro-session" class="headerlink" title="&#x5173;&#x4E8E;shiro session"></a>&#x5173;&#x4E8E;shiro session</h2><p>Shiro &#x4E2D;&#x7684; Session &#x4E0D;&#x4F9D;&#x8D56; HTTP &#x73AF;&#x5883;&#x3002;&#x5982;&#x679C;&#x5C06; Shiro &#x90E8;&#x7F72;&#x5728; web &#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E2D;&#xFF0C;&#x90A3;&#x4E48;&#x8FD9;&#x4E2A; Session &#x5C31;&#x662F;&#x57FA;&#x4E8E;HttpSession &#x7684;&#x3002;&#x5728;&#x975E; web &#x73AF;&#x5883;&#x4E0B;&#x4F7F;&#x7528;&#xFF0C;Shiro &#x5219;&#x9ED8;&#x8BA4;&#x4F7F;&#x7528; EnterpriseSessionManagment</p>
<p>&#x3010;&#x5B8C;&#x3011;</p>
<p>&#x53C2;&#x8003;&#xFF1A;</p>
<p><a href="http://blog.aquariuslt.com/2015/10/25/apache-shiro-spring-integration" target="_blank" rel="external">Spring &#x6574;&#x5408; Apache Shiro &#x5B9E;&#x73B0;&#x5404;&#x7B49;&#x7EA7;&#x7684;&#x6743;&#x9650;&#x7BA1;&#x7406;</a></p>

                        
                    </div>

                    
                    
                    

                    <div class="description post-description">
    <span class="post-description-item">
        <time datetime="2016-02-16T10:25:17.000Z" itemprop="datePublished">2016-02-16</time>

    </span>
    <span class="post-description-item">
        

    <span>
        <i class="tags icon"></i>
    </span>

    
    <span class="ui tiny label">
        <a href="/tags/Shiro/">Shiro</a>
    </span>

    

    </span>
</div>

                </div>
                
                <div id="pagination" class="nav-web ui text container pagination">

    <div class="ui stackable two column divided grid container">
        <div class="row">
            <div class="column nav-left">
                

                <a href="/2016/03/22/Java-SimpleDateFormat的线程安全性问题/" class="ui tiny button">

                    <i class="angle left icon"></i>
                    
                    Java SimpleDateFormat的线程安全性问题
                    

                </a>

                
            </div>
            <div class="column nav-right">
                

                <a href="/2016/02/02/linux核心命令/" class="ui tiny button">
                    
                    linux核心命令
                    
                    <i class="angle right icon"></i></a>
                
            </div>
        </div>
    </div>

</div>
                
            </div>

            
            <div class="three wide computer three wide tablet column">

                <div class="ui sticky article-toc" id="article-toc">
                    <!-- toc -->
                    <ol class="ui ordered list"><li><a href="#shiro核心概念"><span>shiro核心概念</span></a><ol><li><a href="#Subject"><span>Subject</span></a></li><li><a href="#SecurityManager"><span>SecurityManager</span></a></li><li><a href="#Realms"><span>Realms</span></a></li></ol></li><li><a href="#maven配置依赖"><span>maven配置依赖</span></a></li><li><a href="#整合spring"><span>整合spring</span></a><ol><li><a href="#web-xml"><span>web.xml</span></a></li><li><a href="#spring配置"><span>spring配置</span></a></li></ol></li><li><a href="#自定义Realm"><span>自定义Realm</span></a></li><li><a href="#权限校验"><span>权限校验</span></a><ol><li><a href="#数据库设计"><span>数据库设计</span></a></li><li><a href="#角色校验"><span>角色校验</span></a></li><li><a href="#URL权限校验"><span>URL权限校验</span></a></li></ol></li><li><a href="#常见问题"><span>常见问题</span></a><ol><li><a href="#关于shiro-session"><span>关于shiro session</span></a></li></ol></li></ol>
                </div>

            </div>
            

        </div>
    </div>
</div>


<!-- duoshuo start -->
<div class="ds-thread" data-thread-key="2016/02/16/Shiro与Spring集成实现权限管理/" data-title="Shiro与Spring集成实现权限管理 | 刘梓" data-url="http://zclau.com/2016/02/16/Shiro与Spring集成实现权限管理/"></div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
    var duoshuoQuery = {short_name:"zclau"};
    (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0]
        || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
</script>
<!-- duoshuo end -->

                    <!--</div>-->
                <!--</div>-->
            <!--</div>-->
        </div>
        <div class="ui vertical footer segment">
    <div class="ui center aligned container">
        <div class="ui inverted section divider"></div>
        &copy; 2017 <a href="/">zclau</a>,
        Powered by <a href="https://github.com/henryhuang/hexo-theme-aloha" target="_blank">Aloha</a> and <a
                href="http://hexo.io/" target="_blank">Hexo</a>.
    </div>
</div>

    </div>




<!-- scripts list from theme config.yml -->

<script src="//cdn.bootcss.com/jquery/3.1.0/jquery.min.js"></script>

<script src="//cdn.bootcss.com/semantic-ui/2.2.4/semantic.min.js"></script>

<script src="//cdn.bootcss.com/algoliasearch/3.18.1/algoliasearch.min.js"></script>

<script src="//cdn.bootcss.com/algoliasearch-helper-js/2.13.0/algoliasearch.helper.min.js"></script>

<script src="/js/semantic-ui-algolia.js"></script>

<script src="/js/aloha-events.js"></script>



</body>
</html>
